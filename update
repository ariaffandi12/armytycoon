-- Modern Army Tycoon GUI Enhanced
-- Features: Draggable, Minimize/Restore, Auto Rebirth, Player Selection, Nuke & Kill Units, x4 Units, More Unit +100, Nuke Base Player
-- Version: 4.3 - Enhanced with Nuke Base Player

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

-- Create GUI Elements
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local TopBar = Instance.new("Frame")
local TitleLabel = Instance.new("TextLabel")
local MinimizeButton = Instance.new("TextButton")
local CloseButton = Instance.new("TextButton")
local ContentFrame = Instance.new("Frame")
local MinimizedFrame = Instance.new("Frame")
local RestoreButton = Instance.new("TextButton")

-- Player Selection Dropdown
local PlayerFrame = Instance.new("Frame")
local PlayerLabel = Instance.new("TextLabel")
local PlayerDropdown = Instance.new("TextButton")
local PlayerList = Instance.new("ScrollingFrame")

-- Button Frames
local ButtonFrame1 = Instance.new("Frame")
local ButtonFrame2 = Instance.new("Frame")

-- Main Buttons
local KillAllUnitsButton = Instance.new("TextButton")
local GetAllBuildingsButton = Instance.new("TextButton")
local AutoRebirthButton = Instance.new("TextButton")
local NukePlayerButton = Instance.new("TextButton")
local KillPlayerUnitsButton = Instance.new("TextButton")
local NukeMouseButton = Instance.new("TextButton")
local X4UnitsButton = Instance.new("TextButton")
local MoreUnit100Button = Instance.new("TextButton")
local NukeBasePlayerButton = Instance.new("TextButton") -- NEW: Nuke Base Player Button

-- Variables
local selectedPlayer = nil
local autoRebirthEnabled = false
local playerDropdownOpen = false
local x4UnitsEnabled = false
local isSpawning100Units = false
local isNukingBase = false -- NEW: Flag for base nuking

-- Setup ScreenGui
ScreenGui.Name = "ArmyTycoonGUI"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

-- Main Frame Setup (Increased height for new button)
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.3, 0, 0.25, 0)
MainFrame.Size = UDim2.new(0, 350, 0, 550) -- Increased height for new button
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Visible = true

-- Add rounded corners to main frame
local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

-- Enhanced Dragging for MainFrame
local function makeDraggable(frame)
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    
    frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end

-- Apply enhanced dragging
makeDraggable(MainFrame)

-- Top Bar
TopBar.Name = "TopBar"
TopBar.Parent = MainFrame
TopBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TopBar.BorderSizePixel = 0
TopBar.Size = UDim2.new(1, 0, 0, 35)

local TopCorner = Instance.new("UICorner")
TopCorner.CornerRadius = UDim.new(0, 12)
TopCorner.Parent = TopBar

-- Title Label
TitleLabel.Name = "TitleLabel"
TitleLabel.Parent = TopBar
TitleLabel.BackgroundTransparency = 1
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.Size = UDim2.new(1, -80, 1, 0)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Text = "üöÄ Army Tycoon GUI v4.3 | Nuke Base"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 14
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Minimize Button
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Parent = TopBar
MinimizeButton.BackgroundColor3 = Color3.fromRGB(255, 193, 7)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Position = UDim2.new(1, -65, 0, 5)
MinimizeButton.Size = UDim2.new(0, 25, 0, 25)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Text = "‚àí"
MinimizeButton.TextColor3 = Color3.fromRGB(0, 0, 0)
MinimizeButton.TextSize = 18

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 6)
MinCorner.Parent = MinimizeButton

-- Close Button
CloseButton.Name = "CloseButton"
CloseButton.Parent = TopBar
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "‚úï"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 14

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Content Frame
ContentFrame.Name = "ContentFrame"
ContentFrame.Parent = MainFrame
ContentFrame.BackgroundTransparency = 1
ContentFrame.Position = UDim2.new(0, 0, 0, 35)
ContentFrame.Size = UDim2.new(1, 0, 1, -35)

-- Player Selection Frame
PlayerFrame.Name = "PlayerFrame"
PlayerFrame.Parent = ContentFrame
PlayerFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
PlayerFrame.BorderSizePixel = 0
PlayerFrame.Position = UDim2.new(0, 10, 0, 10)
PlayerFrame.Size = UDim2.new(1, -20, 0, 60)

local PlayerCorner = Instance.new("UICorner")
PlayerCorner.CornerRadius = UDim.new(0, 8)
PlayerCorner.Parent = PlayerFrame

PlayerLabel.Name = "PlayerLabel"
PlayerLabel.Parent = PlayerFrame
PlayerLabel.BackgroundTransparency = 1
PlayerLabel.Position = UDim2.new(0, 10, 0, 5)
PlayerLabel.Size = UDim2.new(1, -20, 0, 20)
PlayerLabel.Font = Enum.Font.Gotham
PlayerLabel.Text = "Select Target Player:"
PlayerLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
PlayerLabel.TextSize = 12
PlayerLabel.TextXAlignment = Enum.TextXAlignment.Left

PlayerDropdown.Name = "PlayerDropdown"
PlayerDropdown.Parent = PlayerFrame
PlayerDropdown.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
PlayerDropdown.BorderSizePixel = 0
PlayerDropdown.Position = UDim2.new(0, 10, 0, 25)
PlayerDropdown.Size = UDim2.new(1, -20, 0, 25)
PlayerDropdown.Font = Enum.Font.Gotham
PlayerDropdown.Text = "Click to select player ‚ñº"
PlayerDropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerDropdown.TextSize = 12

local DropdownCorner = Instance.new("UICorner")
DropdownCorner.CornerRadius = UDim.new(0, 4)
DropdownCorner.Parent = PlayerDropdown

-- Player List (initially hidden) - Enhanced dragging
PlayerList.Name = "PlayerList"
PlayerList.Parent = ScreenGui
PlayerList.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
PlayerList.BorderSizePixel = 0
PlayerList.Position = UDim2.new(0.3, 20, 0.25, 120)
PlayerList.Size = UDim2.new(0, 310, 0, 150)
PlayerList.Visible = false
PlayerList.ScrollBarThickness = 4
PlayerList.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayerList.Active = true

-- Apply enhanced dragging to PlayerList
makeDraggable(PlayerList)

local ListCorner = Instance.new("UICorner")
ListCorner.CornerRadius = UDim.new(0, 8)
ListCorner.Parent = PlayerList

local ListLayout = Instance.new("UIListLayout")
ListLayout.Parent = PlayerList
ListLayout.SortOrder = Enum.SortOrder.Name
ListLayout.Padding = UDim.new(0, 2)

-- Button Frames (Updated sizes)
ButtonFrame1.Name = "ButtonFrame1"
ButtonFrame1.Parent = ContentFrame
ButtonFrame1.BackgroundTransparency = 1
ButtonFrame1.Position = UDim2.new(0, 10, 0, 80)
ButtonFrame1.Size = UDim2.new(1, -20, 0, 290) -- Increased height for new button

ButtonFrame2.Name = "ButtonFrame2"
ButtonFrame2.Parent = ContentFrame
ButtonFrame2.BackgroundTransparency = 1
ButtonFrame2.Position = UDim2.new(0, 10, 0, 380)
ButtonFrame2.Size = UDim2.new(1, -20, 0, 120)

-- Function to create styled buttons
local function createButton(name, parent, position, size, text, color)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Parent = parent
    button.BackgroundColor3 = color
    button.BorderSizePixel = 0
    button.Position = position
    button.Size = size
    button.Font = Enum.Font.GothamSemibold
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 12
    button.TextWrapped = true
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = button
    
    return button
end

-- Create Buttons (Updated positions for new button)
KillAllUnitsButton = createButton("KillAllUnitsButton", ButtonFrame1, UDim2.new(0, 0, 0, 0), UDim2.new(0.48, 0, 0, 40), "üíÄ Kill All Units", Color3.fromRGB(220, 53, 69))
GetAllBuildingsButton = createButton("GetAllBuildingsButton", ButtonFrame1, UDim2.new(0.52, 0, 0, 0), UDim2.new(0.48, 0, 0, 40), "üèóÔ∏è Get All Buildings", Color3.fromRGB(40, 167, 69))
AutoRebirthButton = createButton("AutoRebirthButton", ButtonFrame1, UDim2.new(0, 0, 0, 50), UDim2.new(0.48, 0, 0, 40), "üîÑ Auto Rebirth: OFF", Color3.fromRGB(108, 117, 125))
NukePlayerButton = createButton("NukePlayerButton", ButtonFrame1, UDim2.new(0.52, 0, 0, 50), UDim2.new(0.48, 0, 0, 40), "‚ò¢Ô∏è Nuke Player", Color3.fromRGB(255, 193, 7))
KillPlayerUnitsButton = createButton("KillPlayerUnitsButton", ButtonFrame1, UDim2.new(0, 0, 0, 100), UDim2.new(0.48, 0, 0, 40), "‚öîÔ∏è Kill Player Units", Color3.fromRGB(220, 53, 69))
NukeMouseButton = createButton("NukeMouseButton", ButtonFrame1, UDim2.new(0.52, 0, 0, 100), UDim2.new(0.48, 0, 0, 40), "üéØ Nuke Mouse (Q)", Color3.fromRGB(255, 106, 0))
X4UnitsButton = createButton("X4UnitsButton", ButtonFrame1, UDim2.new(0, 0, 0, 150), UDim2.new(0.48, 0, 0, 40), "‚ö° x4 Units: OFF", Color3.fromRGB(138, 43, 226))
MoreUnit100Button = createButton("MoreUnit100Button", ButtonFrame1, UDim2.new(0.52, 0, 0, 150), UDim2.new(0.48, 0, 0, 40), "üî• More Unit +100", Color3.fromRGB(255, 20, 147))

-- NEW: Nuke Base Player Button
NukeBasePlayerButton = createButton("NukeBasePlayerButton", ButtonFrame1, UDim2.new(0, 0, 0, 200), UDim2.new(1, 0, 0, 40), "üí• Nuke Base Player", Color3.fromRGB(255, 69, 0))

-- Status Label for operations
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Parent = ButtonFrame1
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 0, 0, 250)
StatusLabel.Size = UDim2.new(1, 0, 0, 30)
StatusLabel.Font = Enum.Font.GothamSemibold
StatusLabel.Text = "Ready for operations"
StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
StatusLabel.TextSize = 11
StatusLabel.TextXAlignment = Enum.TextXAlignment.Center

-- Minimized Frame (Enhanced dragging)
MinimizedFrame.Name = "MinimizedFrame"
MinimizedFrame.Parent = ScreenGui
MinimizedFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MinimizedFrame.BorderSizePixel = 0
MinimizedFrame.Position = UDim2.new(0, 10, 0.5, -15)
MinimizedFrame.Size = UDim2.new(0, 120, 0, 30)
MinimizedFrame.Visible = false
MinimizedFrame.Active = true

-- Apply enhanced dragging to MinimizedFrame
makeDraggable(MinimizedFrame)

local MinFrameCorner = Instance.new("UICorner")
MinFrameCorner.CornerRadius = UDim.new(0, 8)
MinFrameCorner.Parent = MinimizedFrame

RestoreButton.Name = "RestoreButton"
RestoreButton.Parent = MinimizedFrame
RestoreButton.BackgroundTransparency = 1
RestoreButton.Size = UDim2.new(1, 0, 1, 0)
RestoreButton.Font = Enum.Font.GothamSemibold
RestoreButton.Text = "üöÄ Enhanced GUI"
RestoreButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RestoreButton.TextSize = 12

-- Helper Functions
local function updatePlayerList()
    -- Clear existing players
    for _, child in pairs(PlayerList:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    local yPos = 0
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local playerButton = Instance.new("TextButton")
            playerButton.Name = player.Name
            playerButton.Parent = PlayerList
            playerButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            playerButton.BorderSizePixel = 0
            playerButton.Position = UDim2.new(0, 5, 0, yPos)
            playerButton.Size = UDim2.new(1, -10, 0, 25)
            playerButton.Font = Enum.Font.Gotham
            playerButton.Text = player.Name
            playerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            playerButton.TextSize = 12
            
            local btnCorner = Instance.new("UICorner")
            btnCorner.CornerRadius = UDim.new(0, 4)
            btnCorner.Parent = playerButton
            
            playerButton.MouseButton1Click:Connect(function()
                selectedPlayer = player
                PlayerDropdown.Text = "Selected: " .. player.Name
                PlayerList.Visible = false
                playerDropdownOpen = false
            end)
            
            yPos = yPos + 27
        end
    end
    
    PlayerList.CanvasSize = UDim2.new(0, 0, 0, yPos)
end

local function getAllBuildings()
    for i,v in pairs(game.Workspace.Game.Buttons:GetChildren()) do
        if v.Name == LocalPlayer.Name then
            for i,v2 in pairs(v:GetChildren()) do
                ReplicatedStorage.RE.relinquish:FireServer(v2, true)
            end
        end
    end
    
    wait(0.1)
    
    for i,v in pairs(game.Workspace.Game.Buttons:GetChildren()) do
        if v.Name == LocalPlayer.Name then
            for i,v2 in pairs(v:GetChildren()) do
                for i,v3 in pairs(v2:GetChildren()) do
                    if v3:IsA("ObjectValue") then
                        v3.Name = v3.Value.Name
                    end
                end
            end
        end
    end
    
    wait(0.1)
    
    local buildingTypes = {
        ["Barracks"] = {"Barracks", "2"},
        ["Greenhouse"] = {"Greenhouse", "2"},
        ["Factory"] = {"Factory", "3"},
        ["Oil Field"] = {"Oil Field", "2"},
        ["Guard Tower"] = {"Guard Tower", "1"},
        ["Wall"] = {"Wall", "2"},
        ["Generator Powerplant"] = {"Generator Powerplant", "1"},
        ["Missile Factory"] = {"Missile Factory", "1"},
        ["Command Center"] = {"Command Center", "2"},
        ["Drone Factory"] = {"Drone Factory", "1"},
        ["Nuclear Powerplant"] = {"Nuclear Powerplant", "1"},
        ["Airport"] = {"Airport", "1"},
        ["Helicopter Bay"] = {"Helicopter Bay", "2"},
        ["Main Base"] = {"Main Base", "2"}
    }
    
    for i,v in pairs(game.Workspace.Game.Buttons:GetChildren()) do
        if v.Name == LocalPlayer.Name then
            for i,v2 in pairs(v:GetChildren()) do
                for i,v3 in pairs(v2:GetChildren()) do
                    if v3:IsA("ObjectValue") then
                        local buildingName = v3.Name
                        if buildingName == "Military" then
                            local Class = ReplicatedStorage.Game.Buildings.Military["Tank Factory"]["2"]
                            ReplicatedStorage.RE.insertBuilding:FireServer(Class, v2)
                        elseif buildingTypes[buildingName] then
                            local buildingData = buildingTypes[buildingName]
                            local Class = ReplicatedStorage.Game.Buildings[buildingData[1]][buildingData[2]]
                            ReplicatedStorage.RE.insertBuilding:FireServer(Class, v2)
                        end
                    end
                end
            end
        end
    end
end

-- x4 Units Function
local function spawnX4Units()
    if not x4UnitsEnabled then return end
    
    spawn(function()
        while x4UnitsEnabled do
            wait(1) -- Spawn every second
            
            -- Spawn units from barracks
            for i,v in pairs(game.Workspace.Game.Buildings:GetChildren()) do
                if v.Name == LocalPlayer.Name then
                    for i,v2 in pairs(v:GetChildren()) do
                        if v2.Name == "Barracks" and v2:FindFirstChild("Spawn") then
                            -- Spawn 4 units at once
                            for i = 1, 4 do
                                ReplicatedStorage.RE.spawnUnit:FireServer("Soldier", v2.Spawn)
                                wait(0.1)
                            end
                        end
                    end
                end
            end
        end
    end)
end

-- More Unit +100 Function
local function spawnMoreUnits100()
    if isSpawning100Units then
        StatusLabel.Text = "Already spawning units, please wait..."
        StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        return
    end
    
    isSpawning100Units = true
    StatusLabel.Text = "Spawning 100 units... Please wait"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    MoreUnit100Button.Text = "üî• Spawning..."
    MoreUnit100Button.BackgroundColor3 = Color3.fromRGB(128, 128, 128)
    
    spawn(function()
        local unitsSpawned = 0
        local maxUnits = 100
        
        -- Find all barracks
        local barracks = {}
        for i,v in pairs(game.Workspace.Game.Buildings:GetChildren()) do
            if v.Name == LocalPlayer.Name then
                for i,v2 in pairs(v:GetChildren()) do
                    if v2.Name == "Barracks" and v2:FindFirstChild("Spawn") then
                        table.insert(barracks, v2)
                    end
                end
            end
        end
        
        if #barracks == 0 then
            StatusLabel.Text = "No barracks found! Build barracks first"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
            isSpawning100Units = false
            MoreUnit100Button.Text = "üî• More Unit +100"
            MoreUnit100Button.BackgroundColor3 = Color3.fromRGB(255, 20, 147)
            return
        end
        
        -- Spawn units from all barracks
        while unitsSpawned < maxUnits do
            for _, barrack in pairs(barracks) do
                if unitsSpawned >= maxUnits then break end
                
                -- Try different unit types
                local unitTypes = {"Soldier", "Heavy Soldier", "Sniper", "Medic"}
                local randomUnit = unitTypes[math.random(1, #unitTypes)]
                
                pcall(function()
                    ReplicatedStorage.RE.spawnUnit:FireServer(randomUnit, barrack.Spawn)
                end)
                
                unitsSpawned = unitsSpawned + 1
                StatusLabel.Text = "Spawned: " .. unitsSpawned .. "/100 units"
                
                wait(0.05) -- Small delay to prevent lag
            end
        end
        
        -- Completion
        StatusLabel.Text = "‚úÖ Successfully spawned 100 units!"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        MoreUnit100Button.Text = "üî• More Unit +100"
        MoreUnit100Button.BackgroundColor3 = Color3.fromRGB(255, 20, 147)
        isSpawning100Units = false
        
        -- Reset status after 5 seconds
        wait(5)
        StatusLabel.Text = "Ready for operations"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    end)
end

-- NEW: Nuke Base Player Function
local function nukePlayerBase()
    if not selectedPlayer then
        StatusLabel.Text = "‚ùå Please select a player first!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
        wait(3)
        StatusLabel.Text = "Ready for operations"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        return
    end
    
    if isNukingBase then
        StatusLabel.Text = "Already nuking base, please wait..."
        StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        return
    end
    
    isNukingBase = true
    StatusLabel.Text = "üí• Nuking " .. selectedPlayer.Name .. "'s base..."
    StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    NukeBasePlayerButton.Text = "üí• Nuking..."
    NukeBasePlayerButton.BackgroundColor3 = Color3.fromRGB(128, 128, 128)
    
    spawn(function()
        local buildingsDestroyed = 0
        local nukesLaunched = 0
        
        -- Find all buildings belonging to the selected player
        local targetBuildings = {}
        for i,v in pairs(game.Workspace.Game.Buildings:GetChildren()) do
            if v.Name == selectedPlayer.Name then
                for i,v2 in pairs(v:GetChildren()) do
                    if v2:FindFirstChild("PrimaryPart") or v2:FindFirstChild("Center") then
                        table.insert(targetBuildings, v2)
                    end
                end
            end
        end
        
        if #targetBuildings == 0 then
            StatusLabel.Text = "‚ùå No buildings found for " .. selectedPlayer.Name
            StatusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
            isNukingBase = false
            NukeBasePlayerButton.Text = "üí• Nuke Base Player"
            NukeBasePlayerButton.BackgroundColor3 = Color3.fromRGB(255, 69, 0)
            wait(3)
            StatusLabel.Text = "Ready for operations"
            StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            return
        end
        
        -- Launch nukes at each building
        for _, building in pairs(targetBuildings) do
            local targetPos = nil
            
            -- Try to get building position
            if building:FindFirstChild("PrimaryPart") then
                targetPos = building.PrimaryPart.Position
            elseif building:FindFirstChild("Center") then
                targetPos = building.Center.Position
            elseif building:FindFirstChild("Base") then
                targetPos = building.Base.Position
            else
                -- Get position from any part in the building
                for _, part in pairs(building:GetChildren()) do
                    if part:IsA("BasePart") then
                        targetPos = part.Position
                        break
                    end
                end
            end
            
            if targetPos then
                -- Launch nuke at building
                pcall(function()
                    ReplicatedStorage.RE.FireMissile:FireServer("Nuke", targetPos)
                end)
                
                nukesLaunched = nukesLaunched + 1
                buildingsDestroyed = buildingsDestroyed + 1
                StatusLabel.Text = "üí• Nuked: " .. buildingsDestroyed .. "/" .. #targetBuildings .. " buildings"
                
                wait(0.5) -- Delay between nukes for dramatic effect
            end
        end
        
        -- Also nuke the player's spawn area and main base area
        for i,v in pairs(game.Workspace.Game.Buttons:GetChildren()) do
            if v.Name == selectedPlayer.Name then
                for i,v2 in pairs(v:GetChildren()) do
                    if v2:FindFirstChild("Position") then
                        pcall(function()
                            ReplicatedStorage.RE.FireMissile:FireServer("Nuke", v2.Position.Value)
                        end)
                        nukesLaunched = nukesLaunched + 1
                        wait(0.3)
                    end
                end
            end
        end
        
        -- Final barrage - nuke the general area
        if selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local playerPos = selectedPlayer.Character.HumanoidRootPart.Position
            
            -- Launch multiple nukes around the player's area
            for i = 1, 5 do
                local randomOffset = Vector3.new(
                    math.random(-50, 50),
                    0,
                    math.random(-50, 50)
                )
                
                pcall(function()
                    ReplicatedStorage.RE.FireMissile:FireServer("Nuke", playerPos + randomOffset)
                end)
                
                nukesLaunched = nukesLaunched + 1
                wait(0.2)
            end
        end
        
        -- Completion message
        StatusLabel.Text = "üî• Base destroyed! " .. nukesLaunched .. " nukes launched!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
        NukeBasePlayerButton.Text = "üí• Nuke Base Player"
        NukeBasePlayerButton.BackgroundColor3 = Color3.fromRGB(255, 69, 0)
        isNukingBase = false
        
        -- Reset status after 5 seconds
        wait(5)
        StatusLabel.Text = "Ready for operations"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    end)
end

-- Event Connections
MinimizeButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MinimizedFrame.Visible = true
end)

RestoreButton.MouseButton1Click:Connect(function()
    MinimizedFrame.Visible = false
    MainFrame.Visible = true
end)

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

PlayerDropdown.MouseButton1Click:Connect(function()
    playerDropdownOpen = not playerDropdownOpen
    PlayerList.Visible = playerDropdownOpen
    if playerDropdownOpen then
        updatePlayerList()
    end
end)

KillAllUnitsButton.MouseButton1Click:Connect(function()
    for i,v in pairs(game.Workspace.Game.Units:GetChildren()) do
        if v.Name ~= LocalPlayer.Name then
            for i,v2 in pairs(v:GetChildren()) do
                if v2:FindFirstChild("Torso") then
                    ReplicatedStorage.RE.FireMissile:FireServer("Cruise Missile", v2.Torso.Position)
                end
            end
        end
    end
end)

GetAllBuildingsButton.MouseButton1Click:Connect(function()
    getAllBuildings()
end)

AutoRebirthButton.MouseButton1Click:Connect(function()
    autoRebirthEnabled = not autoRebirthEnabled
    if autoRebirthEnabled then
        AutoRebirthButton.Text = "üîÑ Auto Rebirth: ON"
        AutoRebirthButton.BackgroundColor3 = Color3.fromRGB(40, 167, 69)
        
        spawn(function()
            while autoRebirthEnabled do
                wait(30) -- Wait 30 seconds between rebirths
                if autoRebirthEnabled then
                    getAllBuildings()
                end
            end
        end)
    else
        AutoRebirthButton.Text = "üîÑ Auto Rebirth: OFF"
        AutoRebirthButton.BackgroundColor3 = Color3.fromRGB(108, 117, 125)
    end
end)

-- x4 Units Button Event
X4UnitsButton.MouseButton1Click:Connect(function()
    x4UnitsEnabled = not x4UnitsEnabled
    if x4UnitsEnabled then
        X4UnitsButton.Text = "‚ö° x4 Units: ON"
        X4UnitsButton.BackgroundColor3 = Color3.fromRGB(40, 167, 69)
        spawnX4Units()
    else
        X4UnitsButton.Text = "‚ö° x4 Units: OFF"
        X4UnitsButton.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
    end
end)

-- More Unit +100 Button Event
MoreUnit100Button.MouseButton1Click:Connect(function()
    spawnMoreUnits100()
end)

-- NEW: Nuke Base Player Button Event
NukeBasePlayerButton.MouseButton1Click:Connect(function()
    nukePlayerBase()
end)

NukePlayerButton.MouseButton1Click:Connect(function()
    if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
        ReplicatedStorage.RE.FireMissile:FireServer("Nuke", selectedPlayer.Character.HumanoidRootPart.Position)
    end
end)

KillPlayerUnitsButton.MouseButton1Click:Connect(function()
    if selectedPlayer then
        for i,v in pairs(game.Workspace.Game.Units:GetChildren()) do
            if v.Name == selectedPlayer.Name then
                for i,v2 in pairs(v:GetChildren()) do
                    if v2:FindFirstChild("Torso") then
                        ReplicatedStorage.RE.FireMissile:FireServer("Cruise Missile", v2.Torso.Position)
                    end
                end
            end
        end
    end
end)

NukeMouseButton.MouseButton1Click:Connect(function()
    local mouse = LocalPlayer:GetMouse()
    
    local connection
    connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == Enum.KeyCode.Q then
            ReplicatedStorage.RE.FireMissile:FireServer("Nuke", Vector3.new(mouse.Hit.Position.X, 48.6649132, mouse.Hit.Position.Z))
        end
    end)
    
    NukeMouseButton.connection = connection
end)

-- Hide player list when clicking elsewhere
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and PlayerList.Visible then
        local mouse = LocalPlayer:GetMouse()
        local target = mouse.Target
        
        if not target or not target:IsDescendantOf(PlayerList) and target ~= PlayerDropdown then
            PlayerList.Visible = false
            playerDropdownOpen = false
        end
    end
end)

-- Update player list when players join/leave
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)

print("üöÄ Army Tycoon GUI v4.3 Enhanced loaded successfully!")
print("‚ú® New Features:")
print("   - x4 Units spawning system")
print("   - Enhanced dragging for all GUI elements")
print("   - More Unit +100: Spawn 100 units instantly!")
print("   - Nuke Base Player: Completely destroy player's base!")
print("   - Improved UI responsiveness")
print("   - Real-time status updates")
